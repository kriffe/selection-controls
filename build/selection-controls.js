(function(){function E(b){this.object=b;this.target=new THREE.Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=!1;this.dampingFactor=.25;this.enableTargetLock=this.enableGroundLock=!1;var d=this,k,e,p=0,n=0,m=1,q=new THREE.Vector3,r=!1;this.getPolarAngle=function(){return e};this.getAzimuthalAngle=function(){return k};this.rotateLeft=
function(l){n-=l};this.rotateUp=function(l){p-=l};this.panLeft=function(){var l=new THREE.Vector3;return function(b){var d=this.object.matrix.elements;l.set(d[0],d[1],d[2]);l.multiplyScalar(-b);q.add(l)}}();this.panUp=function(){var l=new THREE.Vector3;return function(b){var e=this.object.matrix.elements;d.enableGroundLock?(l.set(e[4]*(1-d.object.up.x),e[5]*(1-d.object.up.y),e[6]*(1-d.object.up.z)),l.normalize()):l.set(e[4],e[5],e[6]);l.multiplyScalar(b);q.add(l)}}();this.pan=function(b,e,k,f){d.object instanceof
THREE.PerspectiveCamera?(k=d.object.position.clone().sub(d.target).length(),k*=Math.tan(d.object.fov/2*Math.PI/180),d.panLeft(2*b*k/f),d.panUp(2*e*k/f)):d.object instanceof THREE.OrthographicCamera?(d.panLeft(b*(d.object.right-d.object.left)/k),d.panUp(e*(d.object.top-d.object.bottom)/f)):console.warn("WARNING: SelectionControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(b){d.object instanceof THREE.PerspectiveCamera?m/=b:d.object instanceof THREE.OrthographicCamera?
(d.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*b)),d.object.updateProjectionMatrix(),r=!0):console.warn("WARNING: SelectionControls.js encountered an unknown camera type - dolly/zoom disabled.")};this.dollyOut=function(b){d.object instanceof THREE.PerspectiveCamera?m*=b:d.object instanceof THREE.OrthographicCamera?(d.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/b)),d.object.updateProjectionMatrix(),r=!0):console.warn("WARNING: SelectionControls.js encountered an unknown camera type - dolly/zoom disabled.")};
this.update=function(){var d=new THREE.Vector3,z=(new THREE.Quaternion).setFromUnitVectors(b.up,new THREE.Vector3(0,1,0)),A=z.clone().inverse(),f=new THREE.Vector3,c=new THREE.Quaternion;return function(){var b=this.object.position;d.copy(b).sub(this.target);d.applyQuaternion(z);k=Math.atan2(d.x,d.z);e=Math.atan2(Math.sqrt(d.x*d.x+d.z*d.z),d.y);k+=n;e+=p;k=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,k));e=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e));e=Math.max(1E-6,
Math.min(Math.PI-1E-6,e));var l=d.length()*m,l=Math.max(this.minDistance,Math.min(this.maxDistance,l));this.enableTargetLock||this.target.add(q);d.x=l*Math.sin(e)*Math.sin(k);d.y=l*Math.cos(e);d.z=l*Math.sin(e)*Math.cos(k);d.applyQuaternion(A);b.copy(this.target).add(d);this.object.lookAt(this.target);!0===this.enableDamping?(n*=1-this.dampingFactor,p*=1-this.dampingFactor):p=n=0;m=1;q.set(0,0,0);return r||1E-6<f.distanceToSquared(this.object.position)||1E-6<8*(1-c.dot(this.object.quaternion))?(f.copy(this.object.position),
c.copy(this.object.quaternion),r=!1,!0):!1}}()}THREE.SelectionControls=function(b,d){function k(a,b){var d=c.domElement===document?c.domElement.body:c.domElement;f.pan(a,b,d.clientWidth,d.clientHeight)}function e(){return Math.pow(.95,c.zoomSpeed)}function p(a){if(!1!==c.enabled){a.preventDefault();if(a.button===c.mouseButtons.ORBIT){if(!1===c.enableRotate)return;h=g.ROTATE;B.set(a.clientX,a.clientY)}else if(a.button===c.mouseButtons.ZOOM){if(!1===c.enableZoom)return;h=g.DOLLY;t.set(a.clientX,a.clientY)}else if(a.button===
c.mouseButtons.PAN){if(!1===c.enablePan)return;h=g.PAN;u.set(a.clientX,a.clientY)}else a.button===c.mouseButtons.SELECT&&(h=g.SELECT,c.dispatchEvent({type:"select-start",content:a}));h!==g.NONE&&document.addEventListener("mouseup",n,!1)}}function n(a){!1!==c.enabled&&(document.removeEventListener("mouseup",n,!1),h===g.SELECT&&c.dispatchEvent({type:"select-end",content:a}),h=g.NONE)}function m(a){if(!1!==c.enabled&&!1!==c.enableZoom&&h===g.NONE){a.preventDefault();a.stopPropagation();var b=0;void 0!==
a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail);0<b?f.dollyOut(e()):0>b&&f.dollyIn(e());c.enableZoomToMouse&&0<b&&(b=a.target.getBoundingClientRect(),k(-(a.clientX-(b.left+c.domElement.clientWidth/2))/10,-(a.clientY-(b.top+c.domElement.clientHeight/2))/10));c.update()}}function q(a){if(!1!==c.enabled&&!1!==c.enableKeys&&!1!==c.enablePan)switch(a.keyCode){case c.keys.UP:k(0,c.keyPanSpeed);c.update();break;case c.keys.BOTTOM:k(0,-c.keyPanSpeed);c.update();break;case c.keys.LEFT:k(c.keyPanSpeed,
0);c.update();break;case c.keys.RIGHT:k(-c.keyPanSpeed,0);c.update();break;case c.keys.ESC:c.dispatchEvent({type:"abort",content:a})}}function r(a){if(!1!==c.enabled)switch(a.touches.length){case 1:if(!1===c.enableRotate)break;h=g.SELECT;c.dispatchEvent({type:"select-start",content:a});break;case 2:if(!1===c.enableZoom)break;h=g.TOUCH_DOLLY;var b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;t.set(0,Math.sqrt(b*b+a*a));break;case 3:if(!1===c.enablePan)break;h=g.TOUCH_PAN;
u.set(a.touches[0].pageX,a.touches[0].pageY);break;default:h=g.NONE}}function l(a){if(!1!==c.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:break;case 2:if(!1===c.enableZoom)break;if(h!==g.TOUCH_DOLLY)break;var b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;v.set(0,Math.sqrt(b*b+a*a));w.subVectors(v,t);0<w.y?f.dollyOut(e()):0>w.y&&f.dollyIn(e());t.copy(v);c.update();break;case 3:if(!1===c.enablePan)break;if(h!==g.TOUCH_PAN)break;x.set(a.touches[0].pageX,
a.touches[0].pageY);y.subVectors(x,u);k(y.x,y.y);u.copy(x);c.update();break;default:h=g.NONE}}function z(a){!1!==c.enabled&&(h===g.SELECT&&c.dispatchEvent({type:"select-end",content:a}),h=g.NONE)}function A(a){a.preventDefault()}var f=new E(b);this.domElement=void 0!==d?d:document;Object.defineProperty(this,"constraint",{get:function(){return f}});this.getPolarAngle=function(){return f.getPolarAngle()};this.getAzimuthalAngle=function(){return f.getAzimuthalAngle()};this.enableGroundLock=function(){f.enableGroundLock=
!0};this.enableTargetLock=function(){f.enableTargetLock=!0};this.disableTargetLock=function(){f.enableTargetLock=!1};this.setMaxPolarAngle=function(a){f.maxPolarAngle=a};this.enabled=!0;this.center=this.target;this.enableZoom=!0;this.zoomSpeed=1;this.enableRotate=!0;this.rotateSpeed=1;this.enablePan=!0;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.enableKeys=!0;this.enableZoomToMouse=!1;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40,ESC:27};THREE.MOUSE.WHEEL=999;this.mouseButtons=
{SELECT:THREE.MOUSE.LEFT,ORBIT:THREE.MOUSE.RIGHT,ZOOM:THREE.MOUSE.WHEEL,PAN:THREE.MOUSE.MIDDLE};var c=this,B=new THREE.Vector2,C=new THREE.Vector2,D=new THREE.Vector2,u=new THREE.Vector2,x=new THREE.Vector2,y=new THREE.Vector2,t=new THREE.Vector2,v=new THREE.Vector2,w=new THREE.Vector2,g={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5,SELECT:6},h=g.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();this.zoom0=this.object.zoom;this.manualPan=
function(a,b){return k(a,b)};this.manualDolly=function(a){return 0<a?f.dollyIn(a):f.dollyOut(Math.abs(a))};this.update=function(){this.autoRotate&&h===g.NONE&&f.rotateLeft(2*Math.PI/60/60*c.autoRotateSpeed);!0===f.update()&&this.dispatchEvent({type:"change",content:""})};this.reset=function(){h=g.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.object.zoom=this.zoom0;this.object.updateProjectionMatrix();this.dispatchEvent({type:"change",content:""});this.update()};
this.dispose=function(){this.domElement.removeEventListener("contextmenu",A,!1);this.domElement.removeEventListener("mousedown",p,!1);this.domElement.removeEventListener("mousewheel",m,!1);this.domElement.removeEventListener("MozMousePixelScroll",m,!1);this.domElement.removeEventListener("touchstart",r,!1);this.domElement.removeEventListener("touchend",z,!1);this.domElement.removeEventListener("touchmove",l,!1);document.removeEventListener("mouseup",n,!1);window.removeEventListener("keydown",q,!1)};
this.domElement.addEventListener("contextmenu",A,!1);this.domElement.addEventListener("mousedown",p,!1);this.domElement.addEventListener("mousemove",function(a){if(!1!==c.enabled){a.preventDefault();var b=c.domElement===document?c.domElement.body:c.domElement;if(h===g.ROTATE){if(!1===c.enableRotate)return;C.set(a.clientX,a.clientY);D.subVectors(C,B);f.rotateLeft(2*Math.PI*D.x/b.clientWidth*c.rotateSpeed);f.rotateUp(2*Math.PI*D.y/b.clientHeight*c.rotateSpeed);B.copy(C)}else if(h===g.DOLLY){if(!1===
c.enableZoom)return;v.set(a.clientX,a.clientY);w.subVectors(v,t);0<w.y?f.dollyIn(e()):0>w.y&&f.dollyOut(e());t.copy(v)}else if(h===g.PAN){if(!1===c.enablePan)return;x.set(a.clientX,a.clientY);y.subVectors(x,u);k(y.x,y.y);u.copy(x)}else h===g.SELECT?c.dispatchEvent({type:"select-move",content:a}):c.dispatchEvent({type:"canvas-move",content:a});h!==g.NONE&&c.update()}},!1);this.domElement.addEventListener("mousewheel",m,!1);this.domElement.addEventListener("MozMousePixelScroll",m,!1);this.domElement.addEventListener("touchstart",
r,!1);this.domElement.addEventListener("touchend",z,!1);this.domElement.addEventListener("touchmove",l,!1);window.addEventListener("keydown",q,!1);this.domElement.addEventListener("dblclick",function(a){c.dispatchEvent({type:"select-double",content:a})},!1);this.update()};THREE.SelectionControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.SelectionControls.prototype.constructor=THREE.SelectionControls;Object.defineProperties(THREE.SelectionControls.prototype,{object:{get:function(){return this.constraint.object}},
target:{get:function(){return this.constraint.target},set:function(b){console.warn("THREE.SelectionControls: target is now immutable. Use target.set() instead.");this.constraint.target.copy(b)}},minDistance:{get:function(){return this.constraint.minDistance},set:function(b){this.constraint.minDistance=b}},maxDistance:{get:function(){return this.constraint.maxDistance},set:function(b){this.constraint.maxDistance=b}},minZoom:{get:function(){return this.constraint.minZoom},set:function(b){this.constraint.minZoom=
b}},maxZoom:{get:function(){return this.constraint.maxZoom},set:function(b){this.constraint.maxZoom=b}},minPolarAngle:{get:function(){return this.constraint.minPolarAngle},set:function(b){this.constraint.minPolarAngle=b}},maxPolarAngle:{get:function(){return this.constraint.maxPolarAngle},set:function(b){this.constraint.maxPolarAngle=b}},minAzimuthAngle:{get:function(){return this.constraint.minAzimuthAngle},set:function(b){this.constraint.minAzimuthAngle=b}},maxAzimuthAngle:{get:function(){return this.constraint.maxAzimuthAngle},
set:function(b){this.constraint.maxAzimuthAngle=b}},enableDamping:{get:function(){return this.constraint.enableDamping},set:function(b){this.constraint.enableDamping=b}},dampingFactor:{get:function(){return this.constraint.dampingFactor},set:function(b){this.constraint.dampingFactor=b}},noZoom:{get:function(){console.warn("THREE.SelectionControls: .noZoom has been deprecated. Use .enableZoom instead.");return!this.enableZoom},set:function(b){console.warn("THREE.SelectionControls: .noZoom has been deprecated. Use .enableZoom instead.");
this.enableZoom=!b}},noRotate:{get:function(){console.warn("THREE.SelectionControls: .noRotate has been deprecated. Use .enableRotate instead.");return!this.enableRotate},set:function(b){console.warn("THREE.SelectionControls: .noRotate has been deprecated. Use .enableRotate instead.");this.enableRotate=!b}},noPan:{get:function(){console.warn("THREE.SelectionControls: .noPan has been deprecated. Use .enablePan instead.");return!this.enablePan},set:function(b){console.warn("THREE.SelectionControls: .noPan has been deprecated. Use .enablePan instead.");
this.enablePan=!b}},noKeys:{get:function(){console.warn("THREE.SelectionControls: .noKeys has been deprecated. Use .enableKeys instead.");return!this.enableKeys},set:function(b){console.warn("THREE.SelectionControls: .noKeys has been deprecated. Use .enableKeys instead.");this.enableKeys=!b}},staticMoving:{get:function(){console.warn("THREE.SelectionControls: .staticMoving has been deprecated. Use .enableDamping instead.");return!this.constraint.enableDamping},set:function(b){console.warn("THREE.SelectionControls: .staticMoving has been deprecated. Use .enableDamping instead.");
this.constraint.enableDamping=!b}},dynamicDampingFactor:{get:function(){console.warn("THREE.SelectionControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");return this.constraint.dampingFactor},set:function(b){console.warn("THREE.SelectionControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");this.constraint.dampingFactor=b}}})})();
