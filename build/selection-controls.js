(function(){function E(b){this.object=b;this.target=new THREE.Vector3;this.minDistance=0;this.maxDistance=Infinity;this.minZoom=0;this.maxZoom=Infinity;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minAzimuthAngle=-Infinity;this.maxAzimuthAngle=Infinity;this.enableDamping=!1;this.dampingFactor=.25;this.enableTargetLock=this.enableGroundLock=!1;this.targetLockConstraints={x:!0,y:!0,z:!0};var d=this,m,l,r=0,q=0,n=1,t=new THREE.Vector3,u=!1;this.getPolarAngle=function(){return l};this.getAzimuthalAngle=
function(){return m};this.rotateLeft=function(e){q-=e};this.rotateUp=function(e){r-=e};this.panLeft=function(){var e=new THREE.Vector3;return function(b){var h=this.object.matrix.elements;d.enableTargetLock?e.set(h[0]*(1-(d.targetLockConstraints.x?1:0)),h[1]*(1-(d.targetLockConstraints.y?1:0)),h[2]*(1-(d.targetLockConstraints.z?1:0))):e.set(h[0],h[1],h[2]);e.multiplyScalar(-b);t.add(e)}}();this.panUp=function(){var e=new THREE.Vector3;return function(b){var h=this.object.matrix.elements;d.enableTargetLock?
(e.set(h[4]*(1-(d.targetLockConstraints.x?1:0)),h[5]*(1-(d.targetLockConstraints.y?1:0)),h[6]*(1-(d.targetLockConstraints.z?1:0))),e.normalize()):e.set(h[4],h[5],h[6]);e.multiplyScalar(b);t.add(e)}}();this.pan=function(b,l,h,f){d.object instanceof THREE.PerspectiveCamera?(h=d.object.position.clone().sub(d.target).length(),h*=Math.tan(d.object.fov/2*Math.PI/180),d.panLeft(2*b*h/f),d.panUp(2*l*h/f)):d.object instanceof THREE.OrthographicCamera?(d.panLeft(b*(d.object.right-d.object.left)/h),d.panUp(l*
(d.object.top-d.object.bottom)/f)):console.warn("WARNING: SelectionControls.js encountered an unknown camera type - pan disabled.")};this.dollyIn=function(b){d.object instanceof THREE.PerspectiveCamera?n/=b:d.object instanceof THREE.OrthographicCamera?(d.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom*b)),d.object.updateProjectionMatrix(),u=!0):console.warn("WARNING: SelectionControls.js encountered an unknown camera type - dolly/zoom disabled.")};this.dollyOut=function(b){d.object instanceof
THREE.PerspectiveCamera?n*=b:d.object instanceof THREE.OrthographicCamera?(d.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/b)),d.object.updateProjectionMatrix(),u=!0):console.warn("WARNING: SelectionControls.js encountered an unknown camera type - dolly/zoom disabled.")};this.update=function(){var e=new THREE.Vector3,d=(new THREE.Quaternion).setFromUnitVectors(b.up,new THREE.Vector3(0,1,0)),h=d.clone().inverse(),f=new THREE.Vector3,c=new THREE.Quaternion;return function(){var b=
this.object.position;e.copy(b).sub(this.target);e.applyQuaternion(d);m=Math.atan2(e.x,e.z);l=Math.atan2(Math.sqrt(e.x*e.x+e.z*e.z),e.y);m+=q;l+=r;m=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,m));l=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,l));l=Math.max(1E-6,Math.min(Math.PI-1E-6,l));var p=e.length()*n,p=Math.max(this.minDistance,Math.min(this.maxDistance,p));this.target.add(t);e.x=p*Math.sin(l)*Math.sin(m);e.y=p*Math.cos(l);e.z=p*Math.sin(l)*Math.cos(m);e.applyQuaternion(h);
b.copy(this.target).add(e);this.object.lookAt(this.target);!0===this.enableDamping?(q*=1-this.dampingFactor,r*=1-this.dampingFactor):r=q=0;n=1;t.set(0,0,0);return u||1E-6<f.distanceToSquared(this.object.position)||1E-6<8*(1-c.dot(this.object.quaternion))?(f.copy(this.object.position),c.copy(this.object.quaternion),u=!1,!0):!1}}()}THREE.SelectionControls=function(b,d){function m(a,b){var d=c.domElement===document?c.domElement.body:c.domElement;f.pan(a,b,d.clientWidth,d.clientHeight)}function l(){return Math.pow(.95,
c.zoomSpeed)}function r(a){if(!1!==c.enabled){a.preventDefault();if(a.button===c.mouseButtons.ORBIT){if(!1===c.enableRotate)return;k=g.ROTATE;B.set(a.clientX,a.clientY)}else if(a.button===c.mouseButtons.ZOOM){if(!1===c.enableZoom)return;k=g.DOLLY;v.set(a.clientX,a.clientY)}else if(a.button===c.mouseButtons.PAN){if(!1===c.enablePan)return;k=g.PAN;w.set(a.clientX,a.clientY)}else a.button===c.mouseButtons.SELECT&&(k=g.SELECT,c.dispatchEvent({type:"select-start",content:a}));k!==g.NONE&&document.addEventListener("mouseup",
q,!1)}}function q(a){!1!==c.enabled&&(document.removeEventListener("mouseup",q,!1),k===g.SELECT&&c.dispatchEvent({type:"select-end",content:a}),k=g.NONE)}function n(a){if(!1!==c.enabled&&!1!==c.enableZoom&&k===g.NONE){a.preventDefault();a.stopPropagation();var b=0;void 0!==a.wheelDelta?b=a.wheelDelta:void 0!==a.detail&&(b=-a.detail);0<b?f.dollyOut(l()):0>b&&f.dollyIn(l());c.enableZoomToMouse&&0<b&&(b=a.target.getBoundingClientRect(),m(-(a.clientX-(b.left+c.domElement.clientWidth/2))/10,-(a.clientY-
(b.top+c.domElement.clientHeight/2))/10));c.update()}}function t(a){if(!1!==c.enabled&&!1!==c.enableKeys&&!1!==c.enablePan)switch(a.keyCode){case c.keys.UP:m(0,c.keyPanSpeed);c.update();break;case c.keys.BOTTOM:m(0,-c.keyPanSpeed);c.update();break;case c.keys.LEFT:m(c.keyPanSpeed,0);c.update();break;case c.keys.RIGHT:m(-c.keyPanSpeed,0);c.update();break;case c.keys.ESC:c.dispatchEvent({type:"abort",content:a})}}function u(a){if(!1!==c.enabled)switch(a.touches.length){case 1:if(!1===c.enableRotate)break;
k=g.SELECT;c.dispatchEvent({type:"select-start",content:a});break;case 2:if(!1===c.enableZoom)break;k=g.TOUCH_DOLLY;var b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;v.set(0,Math.sqrt(b*b+a*a));break;case 3:if(!1===c.enablePan)break;k=g.TOUCH_PAN;w.set(a.touches[0].pageX,a.touches[0].pageY);break;default:k=g.NONE}}function e(a){if(!1!==c.enabled)switch(a.preventDefault(),a.stopPropagation(),a.touches.length){case 1:break;case 2:if(!1===c.enableZoom)break;if(k!==g.TOUCH_DOLLY)break;
var b=a.touches[0].pageX-a.touches[1].pageX;a=a.touches[0].pageY-a.touches[1].pageY;x.set(0,Math.sqrt(b*b+a*a));y.subVectors(x,v);0<y.y?f.dollyOut(l()):0>y.y&&f.dollyIn(l());v.copy(x);c.update();break;case 3:if(!1===c.enablePan)break;if(k!==g.TOUCH_PAN)break;z.set(a.touches[0].pageX,a.touches[0].pageY);A.subVectors(z,w);m(A.x,A.y);w.copy(z);c.update();break;default:k=g.NONE}}function D(a){!1!==c.enabled&&(k===g.SELECT&&c.dispatchEvent({type:"select-end",content:a}),k=g.NONE)}function h(a){a.preventDefault()}
var f=new E(b);this.domElement=void 0!==d?d:document;Object.defineProperty(this,"constraint",{get:function(){return f}});this.getPolarAngle=function(){return f.getPolarAngle()};this.getAzimuthalAngle=function(){return f.getAzimuthalAngle()};this.enableGroundLock=function(){f.enableTargetLock=!0;f.targetLockConstraints.x=0!==c.object.up.x;f.targetLockConstraints.y=0!==c.object.up.y;f.targetLockConstraints.z=0!==c.object.up.z};this.enableTargetLock=function(a){a=a||{};f.enableTargetLock=!0;void 0!==
a.x&&(f.targetLockConstraints.x=a.x);void 0!==a.y&&(f.targetLockConstraints.y=a.y);void 0!==a.z&&(f.targetLockConstraints.z=a.z)};this.disableTargetLock=function(){f.enableTargetLock=!1};this.setMaxPolarAngle=function(a){f.maxPolarAngle=a};this.enabled=!0;this.center=this.target;this.enableZoom=!0;this.zoomSpeed=1;this.enableRotate=!0;this.rotateSpeed=1;this.enablePan=!0;this.keyPanSpeed=7;this.autoRotate=!1;this.autoRotateSpeed=2;this.enableKeys=!0;this.enableZoomToMouse=!1;this.keys={LEFT:37,UP:38,
RIGHT:39,BOTTOM:40,ESC:27};THREE.MOUSE.WHEEL=999;this.mouseButtons={SELECT:THREE.MOUSE.LEFT,ORBIT:THREE.MOUSE.RIGHT,ZOOM:THREE.MOUSE.WHEEL,PAN:THREE.MOUSE.MIDDLE};var c=this,B=new THREE.Vector2,p=new THREE.Vector2,C=new THREE.Vector2,w=new THREE.Vector2,z=new THREE.Vector2,A=new THREE.Vector2,v=new THREE.Vector2,x=new THREE.Vector2,y=new THREE.Vector2,g={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5,SELECT:6},k=g.NONE;this.target0=this.target.clone();this.position0=this.object.position.clone();
this.zoom0=this.object.zoom;this.manualPan=function(a,b){return m(a,b)};this.manualDolly=function(a){return 0<a?f.dollyIn(a):f.dollyOut(Math.abs(a))};this.update=function(){this.autoRotate&&k===g.NONE&&f.rotateLeft(2*Math.PI/60/60*c.autoRotateSpeed);!0===f.update()&&this.dispatchEvent({type:"change",content:""})};this.reset=function(){k=g.NONE;this.target.copy(this.target0);this.object.position.copy(this.position0);this.object.zoom=this.zoom0;this.object.updateProjectionMatrix();this.dispatchEvent({type:"change",
content:""});this.update()};this.dispose=function(){this.domElement.removeEventListener("contextmenu",h,!1);this.domElement.removeEventListener("mousedown",r,!1);this.domElement.removeEventListener("mousewheel",n,!1);this.domElement.removeEventListener("MozMousePixelScroll",n,!1);this.domElement.removeEventListener("touchstart",u,!1);this.domElement.removeEventListener("touchend",D,!1);this.domElement.removeEventListener("touchmove",e,!1);document.removeEventListener("mouseup",q,!1);window.removeEventListener("keydown",
t,!1)};this.domElement.addEventListener("contextmenu",h,!1);this.domElement.addEventListener("mousedown",r,!1);this.domElement.addEventListener("mousemove",function(a){if(!1!==c.enabled){a.preventDefault();var b=c.domElement===document?c.domElement.body:c.domElement;if(k===g.ROTATE){if(!1===c.enableRotate)return;p.set(a.clientX,a.clientY);C.subVectors(p,B);f.rotateLeft(2*Math.PI*C.x/b.clientWidth*c.rotateSpeed);f.rotateUp(2*Math.PI*C.y/b.clientHeight*c.rotateSpeed);B.copy(p)}else if(k===g.DOLLY){if(!1===
c.enableZoom)return;x.set(a.clientX,a.clientY);y.subVectors(x,v);0<y.y?f.dollyIn(l()):0>y.y&&f.dollyOut(l());v.copy(x)}else if(k===g.PAN){if(!1===c.enablePan)return;z.set(a.clientX,a.clientY);A.subVectors(z,w);m(A.x,A.y);w.copy(z)}else k===g.SELECT?c.dispatchEvent({type:"select-move",content:a}):c.dispatchEvent({type:"canvas-move",content:a});k!==g.NONE&&c.update()}},!1);this.domElement.addEventListener("mousewheel",n,!1);this.domElement.addEventListener("MozMousePixelScroll",n,!1);this.domElement.addEventListener("touchstart",
u,!1);this.domElement.addEventListener("touchend",D,!1);this.domElement.addEventListener("touchmove",e,!1);window.addEventListener("keydown",t,!1);this.domElement.addEventListener("dblclick",function(a){c.dispatchEvent({type:"select-double",content:a})},!1);this.update()};THREE.SelectionControls.prototype=Object.create(THREE.EventDispatcher.prototype);THREE.SelectionControls.prototype.constructor=THREE.SelectionControls;Object.defineProperties(THREE.SelectionControls.prototype,{object:{get:function(){return this.constraint.object}},
target:{get:function(){return this.constraint.target},set:function(b){console.warn("THREE.SelectionControls: target is now immutable. Use target.set() instead.");this.constraint.target.copy(b)}},minDistance:{get:function(){return this.constraint.minDistance},set:function(b){this.constraint.minDistance=b}},maxDistance:{get:function(){return this.constraint.maxDistance},set:function(b){this.constraint.maxDistance=b}},minZoom:{get:function(){return this.constraint.minZoom},set:function(b){this.constraint.minZoom=
b}},maxZoom:{get:function(){return this.constraint.maxZoom},set:function(b){this.constraint.maxZoom=b}},minPolarAngle:{get:function(){return this.constraint.minPolarAngle},set:function(b){this.constraint.minPolarAngle=b}},maxPolarAngle:{get:function(){return this.constraint.maxPolarAngle},set:function(b){this.constraint.maxPolarAngle=b}},minAzimuthAngle:{get:function(){return this.constraint.minAzimuthAngle},set:function(b){this.constraint.minAzimuthAngle=b}},maxAzimuthAngle:{get:function(){return this.constraint.maxAzimuthAngle},
set:function(b){this.constraint.maxAzimuthAngle=b}},enableDamping:{get:function(){return this.constraint.enableDamping},set:function(b){this.constraint.enableDamping=b}},dampingFactor:{get:function(){return this.constraint.dampingFactor},set:function(b){this.constraint.dampingFactor=b}},noZoom:{get:function(){console.warn("THREE.SelectionControls: .noZoom has been deprecated. Use .enableZoom instead.");return!this.enableZoom},set:function(b){console.warn("THREE.SelectionControls: .noZoom has been deprecated. Use .enableZoom instead.");
this.enableZoom=!b}},noRotate:{get:function(){console.warn("THREE.SelectionControls: .noRotate has been deprecated. Use .enableRotate instead.");return!this.enableRotate},set:function(b){console.warn("THREE.SelectionControls: .noRotate has been deprecated. Use .enableRotate instead.");this.enableRotate=!b}},noPan:{get:function(){console.warn("THREE.SelectionControls: .noPan has been deprecated. Use .enablePan instead.");return!this.enablePan},set:function(b){console.warn("THREE.SelectionControls: .noPan has been deprecated. Use .enablePan instead.");
this.enablePan=!b}},noKeys:{get:function(){console.warn("THREE.SelectionControls: .noKeys has been deprecated. Use .enableKeys instead.");return!this.enableKeys},set:function(b){console.warn("THREE.SelectionControls: .noKeys has been deprecated. Use .enableKeys instead.");this.enableKeys=!b}},staticMoving:{get:function(){console.warn("THREE.SelectionControls: .staticMoving has been deprecated. Use .enableDamping instead.");return!this.constraint.enableDamping},set:function(b){console.warn("THREE.SelectionControls: .staticMoving has been deprecated. Use .enableDamping instead.");
this.constraint.enableDamping=!b}},dynamicDampingFactor:{get:function(){console.warn("THREE.SelectionControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");return this.constraint.dampingFactor},set:function(b){console.warn("THREE.SelectionControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.");this.constraint.dampingFactor=b}}})})();
